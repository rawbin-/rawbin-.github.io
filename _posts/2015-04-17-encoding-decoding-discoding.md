---
layout: post
title: "Web开发中的编码解码乱码问题深入解析"
date: 2015/4/17 7:09:13 
categories: Web开发 编码 解码 乱码
---

# 基本概念
+ 字符：各种文字和符号的统称，包括各国各族各地的文字，标点符号，图形符号，数字等。
+ 字符集： 字符的集合，比如汉字字符集，ASCII字符集，简体中文字符集，罗马字母等。字符集关心的是这个集合需要包含哪些东西，怎么唯一表示这个集合中的每一个元素。
+ 字符编码： 将字符集处理为计算机能够识别和处理的规则。字符编码关注一个字符如何用二进制表示，如何让计算机精确识别。
+ 内码: 内码是指计算机汉字系统中使用的二进制字符编码，是沟通输入、输出与系统平台之间的交换码，通过内码可以达到通用和高效率传输文本的目的。比如MS Word中所存储和调用的就是内码而非图形文字。英文ASCII字符采用一个字节的内码表示，中文字符如国标字符集中，GB2312、GB12345、GB13000皆用双字节内码，GB18030（27,533汉字）双字节内码汉字为20,902个，其余6,631个汉字用四字节内码。
+ 编码操作： 将信息转换为二进制串的过程。
+ 解码操作： 将字符从二进制串中还原的操作。

## 编码和字符集关系
+ ASCII字符集: ASCII编码
+ ISO 8859-\*字符集: ISO 8859-\*编码 
+ GB2313字符集： GB2312编码
+ BIG5字符集： BIG5编码
+ GB18030字符集： GB18030编码
+ UCS字符集： UCS-2编码，UCS-4编码
+ Unicode字符集：UTF-7，UTF-8编码，UTF-16编码，Unicode编码（UCS-2），Unicode大端，Unicode小端，UTF-32编码
+ ANSI: 使用2个字节来代表一个字符的各种汉字延伸编码方式，称为ANSI编码。 在简体中文系统下，ANSI编码代表GB2312编码，在日文操作系统下，ANSI编码代表JIS编码。 

#文件编码
每个键盘按键都有一个对应的编码，这个是与硬件相关的、跟厂家相关的（扫描码）。为了使各个硬件厂商间的键码进行兼容，出台了一个通用的键盘编码（虚拟键码），虚拟键码是与硬件无关的，不同厂家使用同一套虚拟键码。(默想冯洛伊曼体系)。

汉字的输入过程：各种输入码---交换码（国标码）---内码---字形码（显示汉字，打印汉字）.

输入过程（你在记事本里面写东东）：

+ 打开记事本，切换输入法，并输入“简单”，这里用到的是外码（也叫输入码），不同输入法编码不一样，自然外码也不一样。
+ 键盘驱动程序检测到键盘输入的硬件信号（扫描码），把键码转换为虚拟键码（ASCII），然后将扫描码和虚拟键码（ASCII）及相关信息通过操作系统发给输入法程序
+ 输入法程序将收到的信息转换为汉字内码，同时将汉字内码对应的输出码（字形码）通过操作系统返回给应用程序
+ 应用程序（notepad）处理消息内容，并作出进一步响应。
+ 点击保存，可以选择编码ANSI为系统默认编码，可选Unicode的一种。
+ 应用程序(notepad)将文件内容进行编码并通过操作系统的文件管理系统保存文件。

输出过程（你用记事本打开你写的东东）：

+ 应用程序打开文件（记事本打开文件），应用程序向操作系统读取文件内容（读到的是汉字内码）
+ 操作系统给应用程序返回字节流（汉字内码）
+ 应用程序探测二进制流的编码，并按得到的编码解码，如果没有检测到特征，则按系统默认编码解码（发现是汉字，找汉字字库找对应的的字形码发给显示驱动程序进行显示）。
+ 显示驱动程序把汉字的点阵打到显示器上。
  比如在记事本中输入“联通”，然后以ANSI编码，然后关闭再打开，可以看到乱码，因为记事本搞不清楚编码格式，认为是UTF8。
+ 
+ 


## 参考
0. [字符，字节和编码][12]
0. [输入法工作原理][0]
1. [输入法工作原理][1]
2. [键盘输入工作原理][2]
3. [键盘输入工作原理][3]
4. [关于输入法的工作原理及编程][4]
5. [输入法的基本原理][5]
6. [关于输入法的工作原理及编程][6]
7. [谈谈Windows程序中的字符编码][7]
8. [Windows基础-[文字编码]&lt;转: 编码术语&gt;][8]
9. [文件编码格式（转）][9]
10. [汉字编码表示与显示][10]
11. [汉字编码与编程相关问题总结：ASCII、机内码、区位码、国标码、Unicode码是如何转换的][11]








[0]: http://blog.csdn.net/shuilan0066/article/details/6883629 "输入法工作原理"
[1]: http://www.xp85.com/html/article-98-3220.html "输入法工作原理"
[2]: https://msdn.microsoft.com/zh-cn/library/ms171535v "键盘输入工作原理"
[3]: http://blog.csdn.net/zztfj/article/details/5106832 "键盘输入工作原理"
[4]: http://blog.csdn.net/xiajian2010/article/details/23596865 "关于输入法的工作原理及编程"
[5]: http://blog.163.com/zhao_a_s/blog/static/21635295200791810554941/ "输入法的基本原理"
[6]: http://m.blog.csdn.net/blog/xiajian2010/23596865 "关于输入法的工作原理及编程"
[7]: http://blog.csdn.net/fmddlmyy/article/details/399661 "谈谈Windows程序中的字符编码"
[8]: http://www.cnblogs.com/ztercel/articles/1934752.html "Windows基础-[文字编码]&lt;转: 编码术语&gt;"
[9]: http://www.cnblogs.com/imissherso/articles/640727.html "文件编码格式（转）"
[10]: http://blog.csdn.net/buxoman/article/details/299110 "汉字编码表示与显示"
[11]: http://blog.csdn.net/yeyuangen/article/details/6722193 "汉字编码与编程相关问题总结：ASCII、机内码、区位码、国标码、Unicode码是如何转换的"
[12]: http://www.regexlab.com/zh/encoding.htm "字符，字节和编码"